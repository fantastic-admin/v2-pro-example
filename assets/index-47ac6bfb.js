import{d as I,r as m,B as M,aa as p,G as S,E as x,e as i,a2 as j,j as z,i as n,o as _,f as w,g as s,w as d,L as V,l as y,O as G,Q as H,U as O,t as P,q as Q}from"./index-17000ae8.js";const T=I({__name:"index",props:{id:{type:[Number,String],default:""}},setup(E,{expose:U}){const C=E,v=m(!1),f=m(),a=m({id:C.id,name:"",remark:"",auths:[]}),R=m({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),k=m([]),h=m([]);M(()=>{A(),a.value.id!==""&&L()});function A(){p.get("pages_example/menu/list",{baseURL:"/mock/"}).then(t=>{k.value=t.data;const e=o=>{o.forEach(l=>{var c;h.value.push({id:l.id,auths:l.auths}),((c=l==null?void 0:l.children)==null?void 0:c.length)>0&&e(l.children)})};e(t.data)})}function L(){v.value=!0,p.get("pages_example/role/detail",{baseURL:"/mock/",params:{id:a.value.id}}).then(t=>{v.value=!1,a.value.name=t.data.name,a.value.remark=t.data.remark,a.value.auths=t.data.auths})}const g=S(()=>{const t={};return h.value.forEach(e=>{let o=0;e.auths.forEach(l=>{a.value.auths.includes(l.value)&&o++}),t[e.id]={checkAll:o===e.auths.length,indeterminate:o>0&&o<e.auths.length}}),t});function B(t,e){t?h.value.forEach(o=>{o.id===e&&o.auths.forEach(l=>{a.value.auths.includes(l.value)||a.value.auths.push(l.value)})}):h.value.forEach(o=>{o.id===e&&o.auths.forEach(l=>{a.value.auths=a.value.auths.filter(c=>c!==l.value)})})}return U({submit(){return new Promise(t=>{a.value.id===""?f.value&&f.value.validate(e=>{e&&p.post("pages_example/role/create",a.value,{baseURL:"/mock/"}).then(()=>{x.success({message:"模拟新增成功",center:!0}),t()})}):f.value&&f.value.validate(e=>{e&&p.post("pages_example/role/edit",a.value,{baseURL:"/mock/"}).then(()=>{x.success({message:"模拟编辑成功",center:!0}),t()})})})}}),(t,e)=>{const o=i("el-input"),l=i("el-form-item"),c=i("el-table-column"),b=i("el-checkbox"),D=i("el-checkbox-group"),N=i("el-table"),F=i("el-form"),q=j("loading");return z((_(),w("div",null,[s(F,{ref_key:"formRef",ref:f,model:n(a),rules:n(R),"label-width":"120px","label-suffix":"："},{default:d(()=>[s(l,{label:"名称",prop:"name"},{default:d(()=>[s(o,{modelValue:n(a).name,"onUpdate:modelValue":e[0]||(e[0]=u=>n(a).name=u),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),s(l,{label:"备注",prop:"remark"},{default:d(()=>[s(o,{modelValue:n(a).remark,"onUpdate:modelValue":e[1]||(e[1]=u=>n(a).remark=u),type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),s(l,{label:"权限"},{default:d(()=>[s(N,{data:n(k),"row-key":"id","default-expand-all":"",border:"",stripe:"","highlight-current-row":"",style:{lineHeight:"normal"}},{default:d(()=>[s(c,{prop:"meta.title",width:"300",label:"模块"}),s(c,{label:"权限"},{default:d(u=>[u.row.auths.length?(_(),V(b,{key:0,modelValue:n(g)[u.row.id].checkAll,"onUpdate:modelValue":r=>n(g)[u.row.id].checkAll=r,indeterminate:n(g)[u.row.id].indeterminate,onChange:r=>B(r,u.row.id)},{default:d(()=>[y(" 全选 ")]),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"])):G("",!0),s(D,{modelValue:n(a).auths,"onUpdate:modelValue":e[2]||(e[2]=r=>n(a).auths=r)},{default:d(()=>[(_(!0),w(H,null,O(u.row.auths,r=>(_(),V(b,{key:r.value,label:r.value},{default:d(()=>[y(P(r.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])])),[[q,n(v)]])}}});const K=Q(T,[["__scopeId","data-v-dd211f20"]]);export{K as default};
