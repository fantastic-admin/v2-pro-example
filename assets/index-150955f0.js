import{d as j,r as v,B as G,aa as C,a1 as T,e as i,o as S,f as H,g as e,w as l,i as r,L as J,h as $,t as O,l as m,E as g,_ as Q,q as W}from"./index-17000ae8.js";import{S as X}from"./sortable.esm-be94e56d.js";const Y={class:"form"},Z={class:"index"},I={class:"action-bottom"},ee=j({__name:"index",props:{id:{default:""}},emits:["success","cancel","preview"],setup(B,{emit:V}){const h=B,w=v(),t=v({id:h.id,name:"",code:"",border:!1,stripe:!1,header:!0,columns:[]}),q=v({name:[{required:!0,message:"请输入表格名称",trigger:"blur"}],code:[{required:!0,message:"请输入表格唯一标识",trigger:"blur"}],columns:[{validator:(n,o,d)=>{o.length===0?d(new Error("请添加列信息")):o.some(s=>s.name==="")?d(new Error("列名称不能为空")):o.some(s=>s.field==="")?d(new Error("列字段不能为空")):d()}}]}),x=v(),k=v(0);G(()=>{h.id!==""&&C.get("pages_example/table/detail",{params:{id:h.id},baseURL:"/mock/"}).then(n=>{t.value.id=n.data.id,t.value.name=n.data.name,t.value.code=n.data.code,t.value.border=n.data.border,t.value.stripe=n.data.stripe,t.value.header=n.data.header,t.value.columns=n.data.columns}),R()});function L(){t.value.columns.push({name:"",field:"",width:"100",align:"left",sortable:!1,fixed:"",enable:!0}),T(()=>{x.value.setScrollTop(t.value.columns.length*50)})}function D(n){t.value.columns.splice(n,1)}function R(){const n=x.value.$el.querySelector(".el-table__body-wrapper tbody");X.create(n,{handle:".sortable",animation:300,ghostClass:"ghost",onEnd:({newIndex:o,oldIndex:d})=>{if(o===void 0||d===void 0)return;const s=t.value.columns.splice(d,1)[0];t.value.columns.splice(o,0,s),k.value+=1,T(()=>R())}})}function F(){var n;(n=w.value)==null||n.validate(o=>{o&&(t.value.id===""?C.post("pages_example/table/create",t.value,{baseURL:"/mock/"}).then(()=>{g.success({message:"模拟新增成功",center:!0}),V("success")}):C.post("pages_example/table/edit",t.value,{baseURL:"/mock/"}).then(()=>{g.success({message:"模拟编辑成功",center:!0}),V("success")}))})}async function N(){var d,s;const n=await((d=w.value)==null?void 0:d.validateField("code",p=>{p||g.error("请先完善表格唯一标识")})),o=await((s=w.value)==null?void 0:s.validateField("columns",p=>{p||g.error("请先完善列信息")}));n&&o&&V("preview",{code:t.value.code,border:t.value.border,stripe:t.value.stripe,header:t.value.header,columns:t.value.columns})}return(n,o)=>{const d=i("el-input"),s=i("el-form-item"),p=i("el-col"),f=i("el-switch"),z=i("el-space"),M=i("el-row"),U=Q,y=i("el-icon"),b=i("el-button"),c=i("el-table-column"),A=i("el-tag"),_=i("el-radio-button"),E=i("el-radio-group"),K=i("el-table"),P=i("el-form");return S(),H("div",Y,[e(P,{ref_key:"formRef",ref:w,model:r(t),rules:r(q),"label-width":"100px","label-position":"top"},{default:l(()=>[e(M,{gutter:20},{default:l(()=>[e(p,{span:8},{default:l(()=>[e(s,{label:"表格名称",prop:"name"},{default:l(()=>[e(d,{modelValue:r(t).name,"onUpdate:modelValue":o[0]||(o[0]=a=>r(t).name=a),placeholder:"请输入中文描述标题"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:l(()=>[e(s,{label:"标识",prop:"code"},{default:l(()=>[e(d,{modelValue:r(t).code,"onUpdate:modelValue":o[1]||(o[1]=a=>r(t).code=a),placeholder:"请输入唯一标识"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:l(()=>[e(s,{label:"表格样式"},{default:l(()=>[e(z,{wrap:""},{default:l(()=>[e(f,{modelValue:r(t).border,"onUpdate:modelValue":o[2]||(o[2]=a=>r(t).border=a),"active-text":"开启边框","inactive-text":"关闭边框","inline-prompt":""},null,8,["modelValue"]),e(f,{modelValue:r(t).stripe,"onUpdate:modelValue":o[3]||(o[3]=a=>r(t).stripe=a),"active-text":"开启斑马纹","inactive-text":"关闭斑马纹","inline-prompt":""},null,8,["modelValue"]),e(f,{modelValue:r(t).header,"onUpdate:modelValue":o[4]||(o[4]=a=>r(t).header=a),"active-text":"显示表头","inactive-text":"隐藏表头","inline-prompt":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(s,{label:"列信息",prop:"columns",class:"columns-table"},{default:l(()=>[(S(),J(K,{ref_key:"columnsTableRef",ref:x,key:r(k),data:r(t).columns,border:"",stripe:"","highlight-current-row":""},{default:l(()=>[e(c,{width:"60",align:"center",fixed:""},{header:l(()=>[e(b,{type:"primary",size:"small",plain:"",circle:"",onClick:L},{icon:l(()=>[e(y,null,{default:l(()=>[e(U,{name:"i-ep:plus"})]),_:1})]),_:1})]),default:l(a=>[$("span",Z,O(a.$index+1),1),e(b,{type:"danger",size:"small",plain:"",circle:"",class:"delete",onClick:u=>D(a.$index)},{icon:l(()=>[e(y,null,{default:l(()=>[e(U,{name:"i-ep:delete"})]),_:1})]),_:2},1032,["onClick"])]),_:1}),e(c,{width:"80",align:"center",fixed:""},{header:l(()=>[m(" 排序 ")]),default:l(()=>[e(A,{type:"info",class:"sortable"},{default:l(()=>[e(y,null,{default:l(()=>[e(U,{name:"i-ep:d-caret"})]),_:1})]),_:1})]),_:1}),e(c,{label:"名称","min-width":"200"},{default:l(a=>[e(d,{modelValue:a.row.name,"onUpdate:modelValue":u=>a.row.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"字段",width:"150"},{default:l(a=>[e(d,{modelValue:a.row.field,"onUpdate:modelValue":u=>a.row.field=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"宽度",width:"120"},{default:l(a=>[e(d,{modelValue:a.row.width,"onUpdate:modelValue":u=>a.row.width=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"对齐",width:"240",align:"center"},{default:l(a=>[e(E,{modelValue:a.row.align,"onUpdate:modelValue":u=>a.row.align=u},{default:l(()=>[e(_,{label:"left"},{default:l(()=>[m(" 左对齐 ")]),_:1}),e(_,{label:"center"},{default:l(()=>[m(" 居中 ")]),_:1}),e(_,{label:"right"},{default:l(()=>[m(" 右对齐 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"固定",width:"260",align:"center"},{default:l(a=>[e(E,{modelValue:a.row.fixed,"onUpdate:modelValue":u=>a.row.fixed=u},{default:l(()=>[e(_,{label:"left"},{default:l(()=>[m(" 固定左侧 ")]),_:1}),e(_,{label:""},{default:l(()=>[m(" 默认 ")]),_:1}),e(_,{label:"right"},{default:l(()=>[m(" 固定右侧 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"排序",width:"80",align:"center"},{default:l(a=>[e(f,{modelValue:a.row.sortable,"onUpdate:modelValue":u=>a.row.sortable=u,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"状态",width:"80",align:"center"},{default:l(a=>[e(f,{modelValue:a.row.enable,"onUpdate:modelValue":u=>a.row.enable=u,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"]),$("div",I,[e(b,{type:"primary",onClick:F},{default:l(()=>[m(" 保存 ")]),_:1}),e(b,{type:"info",onClick:N},{default:l(()=>[m(" 预览 ")]),_:1}),e(b,{onClick:o[5]||(o[5]=a=>V("cancel"))},{default:l(()=>[m(" 取消 ")]),_:1})])])}}});const te=W(ee,[["__scopeId","data-v-c50f4437"]]);export{te as default};
